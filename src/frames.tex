\begin{frame}
  \titlepage
  \hypertarget{titlePage}{}
\end{frame}

\begin{frame}
  \frametitle{Write path}
  \sqlinline{CREATE TABLE arrs (pk int, a int[]);}

  \sqlinline{CREATE INDEX ON arrs USING gin (a);}
  \pause

  \sqlinline{INSERT INTO arrs VALUES (11, '{1, 3, 5, 3}');}
  \pause

  \begin{itemize}
    \item insert to the main table
      \pause
    \item insert to the secondary index
      \pause
      \begin{itemize}
        \item extract deduped scan entries: \textinline{1}, \textinline{3},
          \textinline{5}
          \pause
        \item write records \emph{entry} $\rightarrow$ \emph{pk}:
          \pause
          \begin{itemize}
            \item \textinline{1} $\rightarrow$ \textinline{11}
              \pause
            \item \textinline{3} $\rightarrow$ \textinline{11}
              \pause
            \item \textinline{5} $\rightarrow$ \textinline{11}
          \end{itemize}
      \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Read path}
  First, insert some more rows:

  \sqlinline{INSERT INTO arrs VALUES (12, '{1, 3, 2}');}

  \sqlinline{INSERT INTO arrs VALUES (13, '{5, 3}');}
  \pause

  Second, select rows whose array column intersects with \sqlinline{'{5}'}:

  \sqlinline{SELECT * FROM arrs WHERE a && '{5}';}
  \pause

  \emph{Note: this will be an index scan (not index only scan).}
  \pause

  \begin{itemize}
    \item extract scan entries: \textinline{5}
      \pause
    \item set up binds on index
      \begin{itemize}
        \item \textinline{a}$'$ $=$ \textinline{5}
      \end{itemize}
      \pause
    \item set up targets on both index and indexed table
      \begin{itemize}
        \item \cinline{YBIdxBaseTupleIdAttributeNumber} for index
          \pause
        \item \cinline{YBTupleIdAttributeNumber} for table
          \pause
        \item \textinline{pk} for table for \sqlinline{SELECT *}
          \pause
        \item \textinline{a} for table for \sqlinline{SELECT *}
      \end{itemize}
      \pause
    \item retrieve each row and recheck condition
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Read path with AND}
  Select rows whose array column contains elements \sqlinline{1} \emph{and}
  \sqlinline{3}:

  \sqlinline{SELECT * FROM arrs WHERE a @> '{3, 1, 1, 3}';}
  \pause

  \begin{itemize}
    \item extract scan entries: \textinline{1}, \textinline{3}
      \pause
    \item \textbf{split to required and additional entries}:
      \pause
      \begin{itemize}
        \item ideally, the less frequent scan entry is chosen required:
          \textinline{1} should be required
          \pause
        \item currently, hueristics aren't present, so it's arbitrary:
          \textinline{1} is additional, \textinline{3} is required
      \end{itemize}
      \pause
    \item set up binds on index
      \begin{itemize}
        \item \textinline{a}$'$ $=$ \textinline{3}
      \end{itemize}
      \pause
    \item set up targets on both index and indexed table
      \begin{itemize}
        \item \cinline{YBIdxBaseTupleIdAttributeNumber} for index
        \item \cinline{YBTupleIdAttributeNumber} for table
        \item \textinline{pk} for table for \sqlinline{SELECT *}
        \item \textinline{a} for table for \sqlinline{SELECT *}
      \end{itemize}
      \pause
    \item retrieve each row and recheck condition
  \end{itemize}
\end{frame}
